<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Dashboard — Event Planner</title>
    <meta name="viewport" content="width=device-width,initial-scale=1, viewport-fit=cover" />
    <link rel="stylesheet" href="./css/style.css" />
</head>

<body>
    <a href="#main" class="sr-only">Skip to main content</a>

    <script>
        // Early auth guard (évite d’afficher la page si pas logué)
        (function () {
            try {
                var now = Math.floor(Date.now() / 1000);
                for (var i = 0; i < localStorage.length; i++) {
                    var k = localStorage.key(i);
                    if (!/^sb-.*-auth-token$/.test(k)) continue;
                    var raw = localStorage.getItem(k); if (!raw) continue;
                    var s = JSON.parse(raw);
                    var ss = s.currentSession || s.session || s;
                    var exp = typeof ss?.expires_at === "number" ? ss.expires_at : 0;
                    if (exp > now) return; // OK
                }
            } catch { }
            location.replace("./index.html");
        }());
    </script>

    <div id="__header"></div>

    <main id="main" class="container" role="main" aria-labelledby="page-title">

        <h1 id="page-title">Dashboard</h1>

        <section class="card">
            <h2>My events <small id="count-my-events" class="muted"></small></h2>
            <ul id="list-my-events" class="list"></ul>
        </section>

        <section class="card">
            <h2>Events I’m Invited To</h2>
            <ul id="list-invited-events" class="list"></ul>
        </section>

        <section class="card">
            <h2>Pending Invitations</h2>
            <ul id="list-my-invites" class="list"></ul>
        </section>

        <section class="card" id="inv-me">
            <h2>Invitations for Me</h2>

            <!-- ▼ Repliables: Pending / Accepted / Maybe / Declined ▼ -->
            <h3 class="sub">
                <button class="collapse-toggle" data-target="#list-inv-me-pending" aria-expanded="false"
                    aria-controls="list-inv-me-pending">
                    Pending <span id="cnt-pend"></span>
                </button>
            </h3>
            <ul id="list-inv-me-pending" class="list hidden"></ul>

            <h3 class="sub">
                <button class="collapse-toggle" data-target="#list-inv-me-accepted" aria-expanded="false"
                    aria-controls="list-inv-me-accepted">
                    Accepted <span id="cnt-acc"></span>
                </button>
            </h3>
            <ul id="list-inv-me-accepted" class="list hidden"></ul>

            <h3 class="sub">
                <button class="collapse-toggle" data-target="#list-inv-me-maybe" aria-expanded="false"
                    aria-controls="list-inv-me-maybe">
                    Maybe <span id="cnt-may"></span>
                </button>
            </h3>
            <ul id="list-inv-me-maybe" class="list hidden"></ul>

            <h3 class="sub">
                <button class="collapse-toggle" data-target="#list-inv-me-declined" aria-expanded="false"
                    aria-controls="list-inv-me-declined">
                    Declined <span id="cnt-dec"></span>
                </button>
            </h3>
            <ul id="list-inv-me-declined" class="list hidden"></ul>
            <!-- ▲ Repliables ▲ -->
        </section>
    </main>

    <div id="__footer"></div>

    <script type="module">
        import { loadPartials } from "./js/load-partials.js";
        await loadPartials();
        await import("./js/auth.js");
        await import("./js/header-logo.js");
        await import("./js/dashboard.js");
    </script>

</body>

</html>