<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Event details — Event Planner</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="../css/style.css" />
</head>

<body>
    <a href="#main" class="sr-only">Skip to main content</a>

    <script>
        (function () {
            try {
                var now = Math.floor(Date.now() / 1000);
                for (var i = 0; i < localStorage.length; i++) {
                    var k = localStorage.key(i);
                    if (!/^sb-.*-auth-token$/.test(k)) continue;
                    var raw = localStorage.getItem(k); if (!raw) continue;
                    var s = JSON.parse(raw); var ss = s.currentSession || s.session || s;
                    var exp = typeof ss?.expires_at === "number" ? ss.expires_at : 0;
                    if (exp > now) return;
                }
            } catch { }
            location.replace("../index.html");
        }());
    </script>

    <div id="__header"></div>

    <main id="main" class="container" role="main" aria-labelledby="page-title">

        <h1 id="event-title">Event</h1>
        <p id="event-time" class="muted"></p>
        <p id="event-location"></p>
        <article id="event-notes" class="prose"></article>

        <div class="row" style="gap:8px; margin-top:12px;">
            <a id="btn-back" class="btn ghost" href="#">Back</a>
            <a id="btn-edit" class="btn" href="#">Edit</a>
            <button id="btn-delete" class="btn danger" type="button">Delete</button>
            <a id="btn-gcal" class="btn" href="#" target="_blank" rel="noopener">Add to Google</a>
            <a id="btn-ics" class="btn ghost" href="#">Download .ics</a>
        </div>

        <section id="guests" class="card" style="margin-top:16px;">
            <h2>Guests</h2>

            <!-- Vue organisateur : 4 listes -->
            <div id="guests-owner" class="guests-buckets hidden">
                <h3 class="sub">Pending <span id="gcnt-p"></span></h3>
                <ul id="glist-p" class="list"></ul>

                <h3 class="sub">Accepted <span id="gcnt-a"></span></h3>
                <ul id="glist-a" class="list"></ul>

                <h3 class="sub">Maybe <span id="gcnt-m"></span></h3>
                <ul id="glist-m" class="list"></ul>

                <h3 class="sub">Declined <span id="gcnt-d"></span></h3>
                <ul id="glist-d" class="list"></ul>
            </div>

            <!-- Vue invité : ma réponse uniquement -->
            <div id="guest-self" class="hidden">
                <p>Your response: <span id="guest-self-status" class="badge">pending</span></p>
                <div class="row" style="gap:8px;margin-top:6px;">
                    <button class="btn sm" data-action="respond" data-status="accepted">Accept</button>
                    <button class="btn sm ghost" data-action="respond" data-status="maybe">Maybe</button>
                    <button class="btn sm danger" data-action="respond" data-status="declined">Decline</button>
                </div>
                <p class="muted" id="guest-self-msg" style="margin-top:6px;"></p>
            </div>
        </section>


        <p id="details-error" class="status error"></p>
    </main>

    <div id="__footer"></div>

    <script type="module">
        import { loadPartials } from "../js/load-partials.js";
        await loadPartials();
        await import("../js/auth.js");
        await import("../js/header-logo.js");
        await import("../js/event-details.js");
    </script>
</body>

</html>